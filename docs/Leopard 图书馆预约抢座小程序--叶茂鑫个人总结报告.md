### Leopard 图书馆预约抢座小程序个人总结报告--叶茂鑫



#### 一、负责分工

1. 小程序前端的整体架构和安排 
2. 抓包所有的图书馆网络请求接口
3. 小程序基本框架的编写和各个部分的整合安排
4. 后端服务器的搭建优化和前后端接口设计
5. 每轮小程序的测试和整合修改
6. 博客的编写
7. Github的管理

#### 二、主要工作部分介绍

##### 1. 小程序的前端设计框架

指定设计好四个页面的部分和整体的App.js、App.json的编写和使用的框架

剩下的部分直接在对应的page页面中编写即可。



##### 2. 抓包分析所有的图书馆网络请求

​    通过Charles抓包软件设置证书认证后，通过Charles抓包手机端的自习助手的网络请求（包括安卓端和IOS端）。

获得对应的网络请求，再进行请求分析，结合实际图书馆的情况猜测和验证了所有的网络请求参数的含义。

其中最为重要的是**token令牌**的获取，只需要拿到token令牌即可伪装为正常的客户端使用。

  将**所有的网络请求和分析数据写到WebRequest文件夹下的markdown文件和PDF**中。

![](C:\Users\叶十一\Documents\GitHub\LASD\docs\images\P3\ymx\1.png)

上图为部分的抓包信息介绍。



##### 3. 后端程序的搭建

小程序后端服务器的功能：

1. 作为预约的实际执行端，释放前端的计时程序
2. 转发所有小程序端向图书馆发起的请求，从而解决微信小程序的防盗链设计Referer问题。
3. 提供统一的网络接口给前端调用
4. 增加获取第二天的具体日期的信息

实际上上述功能十分重要，没有后端的情况下，小程序端向图书馆的所有请求会因为小程序不可改的Referer请求头而被拦截。

因此后端设计中必须转发所有的GET、POST请求。

另外通过服务器获取第二天的日期信息，减少了前端的计算。



##### 4. 调试和完善整合后的代码

由于分开写的时候，尽管约定好了相关的请求接口，但是还是存在很多问题。

1. 部分同学没有使用上自动化的操作和数据存储。

比如统一使用wx.setStorage等函数。

2. 请求网络信息的顺序有问题，导致信息不能正常获取

3. 有的代码实际无法运行，变量写成常量

等等问题很多，需要整合和测试修改。



##### 5. 设计后台定时抢座的程序

通过SpringBoot和 Java的线程池和调度安排好预约任务



##### 6. 增加关于备选项的抢座

需要增加一部分的处理



##### 7. 博客和GitHub的管理



#### 三、难点和重点问题

