## Leopard 图书馆预约抢座小程序项目

### 个人总结报告--许敏章



#### 一、负责工作

1. 完成小程序预约功能模块
2. 完善小程序的界面美化
3. 完善TabBar的六种图标设计
4. 修复了相关一些bug，包括其他模块的bug
5. 完成一部分的GitHub文档Readme说明的编写

#### 二、工作细节介绍

##### 1. 主体工作：预约界面的设计和编码

1.1 使用到的抓包接口(具体返回的数据不再列出，见WebRequest)

**获取座位总体分布信息**

> Request：https://seat.lib.whu.edu.cn:8443/rest/v2/free/filters&token=CQZE5BWJFM11125527
>
>通过该接口提供的场馆、房间、楼层信息规划页面,让用户进行选择。
>
>token:登录时获取的令牌信息，保存在微信小程序本地。



**获取具体每个馆信息**

>在用户选取场馆后刷新该场馆所有房间的信息，最重要的是可用座位有多少
>
>Request：https://seat.lib.whu.edu.cn:8443/rest/v2/room/stats2/ **1**?token=CQZE5BWJFM11125527
>
>**参数说明：加黑1代表信息馆，可以更换为2 3 4，token参数不可以少**
>
>  Response：可以获得其中的所有楼层的所有房间的具体信息。
>
>   所有座位信息只代表当前此刻的信息，想根据时间来看必须看 3



**使用时间信息进行座位筛选可用座位**

>要求提供开始时间、结束时间（要求半小时为间隔）
>
>Request：https://seat.lib.whu.edu.cn:8443/rest/v2/searchSeats/  **2019-11-12/570/1320**  
>
>method:**POST**,必须使用POST，因此服务器端也必须更改为POST方式不能用get请求  
>
>data参数：token=CQZE5BWJFM11125527&**t**=1&**roomId**=15&**buildingId**=1&**batch**=9999&**page**=1&**t2**=2
>
> 后面三个数据2019-11-12代表日期，570代表从0点开始到用户输入的开始时间的分钟数(30的倍数)



**获取可用开始时间**

>Request：http://seat.lib.whu.edu.cn/rest/v2/startTimesForSeat/ **2508**/**2019-11-12**?token=J8PM1O4QZN11122226
>
>**加黑参数：座位的id  ，日期**  ，**token**



**选择结束时间（会根据开始时间的不同进行刷新）**

>Request:  http://seat.lib.whu.edu.cn/rest/v2/endTimesForSeat/ **2778**/**2019-11-12**/**1200**?token=J8PM1O4QZN11122226
>
>**参数：座位id，日期，开始时间id（对应分钟数）**，**token**
>
>强调返回的数据中，条目换成**endTimes**了,与开始时间列表不太一样



**预约(自由预约)**

>Request:  http://seat.lib.whu.edu.cn/rest/v2/freeBook?    **token=J8PM1O4QZN11122226**&**startTime=1110**&**endTime=1320**&**seat=2778**&**date=2019-11-12**
>
>参数：token，开始时间、结束时间、日期
>
>返回该预约单的信息。
>
>提交方式POST

以上是依赖于抓包获取的接口信息。

由于后端做了非常不错的转发支持，所以可以发送给自己的服务器的数据和内容跟直接向图书馆服务器差别不大。

##### 1.2 页面设计

![](images\P3\xmz\5.jpg)

上图为迭代后的小程序截图效果。

主要部件：武大动漫风图片、日期下拉框、场馆、房间、开始事件、结束时间、搜索和预约按钮、备选位置、位置。

上述下拉框还根据功能的不同有不同的设计效果。由于使用的组件的功能不够强大，

还特别进行了自主设计，强化了下拉框的功能。(此部分将在第三部分详细谈)



**座位信息细节**：提示是否有电源和窗户

![6](images\P3\xmz\6.jpg)



**房间信息细节**：提示可用座位数和所在楼层



![3](images\P3\xmz\3.jpg)



**时间细节**：从8点开始的，每半小时为单位

![4](images\P3\xmz\4.jpg)

